/**
 * @file controller.js
 *
 * Interacts with web-server for sending and recieving data.
 *//**
 * Global variable to set value of failed record requests
 * to true/false.
 */function call_animate_save(a,b,c){c?c(b):typeof animate_save!="undefined"&&animate_save(a,b)}function removeReadonlyRanges(a){var b=[],c=a.length;for(var d=0;d<c;d++){var e=a[d];b.push({source:e.source,delta:e.delta,timestamp:e.timestamp})}return b}function record_changesets(a,b,c,d,e,f){if(!a&&!b)return;var g=10,h=get_final_code(a);a=removeReadonlyRanges(a);var i={changesets:JSON.stringify(a),final_code:JSON.stringify(h)};$(".editor-save-code").html("Saving..."),$.ajaxQueue({url:"/code_player/record/"+b+"/",type:"POST",retry:c,code_video_id:b,post_data:i,async:d,data:i,success:function(a){a.status=="OK"?(call_animate_save(".editor-save-code",!0,f),g_record_request_failed&&(g_record_request_failed=!1,typeof finish_all_recordings!="undefined"&&finish_all_recordings()),e!=undefined&&typeof e=="function"&&e()):call_animate_save(".editor-save-code",!1,f)},error:function(a){call_animate_save(".editor-save-code",!1,f);if(!this.async)return;if(NOT_ALLOWED_ERROR_CODES.indexOf(a.status)>=0)return;g_record_request_failed=!0,this.retry+=1;var b=this.retry,c=this.async,d=JSON.parse(this.post_data.changesets),e=this.code_video_id,h=function(){return function(){record_changesets(d,e,b,c,undefined,f)}}(d,e,b,c);this.retry<=g&&setTimeout(h,1e4)}})}function setup_video(a,b,c){$.ajax({url:"/code_player/setup_video/",type:"POST",data:a,dataType:"json",callback:b,callback_arg_obj:c,success:function(a){this.callback(a,this.callback_arg_obj)},error:function(a){}})}function load_video(a){var b=$.ajax({url:"/code_player/play/"+a+"/",type:"GET",dataType:"json",async:!1,success:function(a){},error:function(a){console.log(a)}});return b.status==200?JSON.parse(b.responseText):!1}var g_record_request_failed=!1,NOT_ALLOWED_ERROR_CODES=[500];(function(a){var b=a({});a.ajaxQueue=function(c){function g(b){d=a.ajax(c),d.done(e.resolve).fail(e.reject).then(b,b)}var d,e=a.Deferred(),f=e.promise();return b.queue(g),f.abort=function(h){if(d)return d.abort(h);var i=b.queue(),j=a.inArray(g,i);return j>-1&&i.splice(j,1),e.rejectWith(c.context||c,[f,h,""]),f},f}})(jQuery);